<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Flip 7 - Online Card Game</title>
    
    <!-- Modular CSS Architecture -->
    <!-- Core styles first -->
    <link rel="stylesheet" href="src/ui/styles/core/reset.css?v=1.0">
    <link rel="stylesheet" href="src/ui/styles/core/variables.css?v=1.1">
    
    <!-- Components -->
    <link rel="stylesheet" href="src/ui/styles/components/cards.css?v=1.1">
    <link rel="stylesheet" href="src/ui/styles/components/buttons.css?v=1.1">
    <link rel="stylesheet" href="src/ui/styles/components/player-headers.css?v=1.1">
    <link rel="stylesheet" href="src/ui/styles/components/draw-pile.css?v=2.0">
    <link rel="stylesheet" href="src/ui/styles/components/controls.css?v=1.0">
    <link rel="stylesheet" href="src/ui/styles/components/info-panels.css?v=1.0">
    <link rel="stylesheet" href="src/ui/styles/components/animations.css?v=1.0">
    <link rel="stylesheet" href="src/ui/styles/components/modals.css?v=1.0">
    
    <!-- Layout -->
    <link rel="stylesheet" href="src/ui/styles/layout/desktop.css?v=1.1">
    
    <!-- Mobile-specific modules -->
    <link rel="stylesheet" href="src/ui/styles/mobile/containers.css?v=3.0">
    <link rel="stylesheet" href="src/ui/styles/mobile/headers.css?v=1.0">
    <link rel="stylesheet" href="src/ui/styles/mobile/cards.css?v=3.0">
    
</head>
<body>
    <div class="game-container">
        <!-- Draw Pile Column -->
        <div class="draw-pile-column">
            <div class="draw-pile-area">
                <div class="draw-pile" id="draw-pile">
                    <div class="card back draw-card"></div>
                    <div class="pile-info">
                        <span id="cards-remaining">94</span> cards
                    </div>
                </div>
                <!-- Card Animation Area -->
                <div class="card-animation-area" id="card-animation-area">
                    <!-- Animated card appears here -->
                </div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="game-area">
            <!-- Players Grid -->
            <div class="players-grid" style="position: relative;">
                <!-- Human Player (Top) -->
                <div class="player-area main-player" id="player">
                    <div class="player-header">
                        <span class="round-score">Round: <span class="round-value">0</span></span>
                        <h3>You</h3>
                        <span class="total-score">Total: <span class="score-value">0</span></span>
                    </div>
                    <div class="player-stats">
                        <span class="player-status">Waiting</span>
                    </div>
                    <div class="player-cards" id="player-cards"></div>
                    <div class="action-buttons">
                        <button id="hit-btn" class="btn primary" disabled>Hit</button>
                        <button id="stay-btn" class="btn secondary" disabled>Stay</button>
                    </div>
                </div>

                <!-- Opponent 1 -->
                <div class="player-area opponent-player" id="opponent1">
                    <div class="player-header">
                        <span class="round-score">Round: <span class="round-value">0</span></span>
                        <h3>AI Bot 1</h3>
                        <span class="total-score">Total: <span class="score-value">0</span></span>
                    </div>
                    <div class="player-stats">
                        <span class="player-status">Waiting</span>
                    </div>
                    <div class="player-cards" id="opponent1-cards"></div>
                </div>

                <!-- Opponent 2 -->
                <div class="player-area opponent-player" id="opponent2">
                    <div class="player-header">
                        <span class="round-score">Round: <span class="round-value">0</span></span>
                        <h3>AI Bot 2</h3>
                        <span class="total-score">Total: <span class="score-value">0</span></span>
                    </div>
                    <div class="player-stats">
                        <span class="player-status">Waiting</span>
                    </div>
                    <div class="player-cards" id="opponent2-cards"></div>
                </div>

                <!-- Opponent 3 -->
                <div class="player-area opponent-player" id="opponent3">
                    <div class="player-header">
                        <span class="round-score">Round: <span class="round-value">0</span></span>
                        <h3>AI Bot 3</h3>
                        <span class="total-score">Total: <span class="score-value">0</span></span>
                    </div>
                    <div class="player-stats">
                        <span class="player-status">Waiting</span>
                    </div>
                    <div class="player-cards" id="opponent3-cards"></div>
                </div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="logo-header">
                <img src="images/FLIP7_LOGO_LOCK_UP_transparent.png" alt="Flip 7" class="flip7-logo">
            </div>

            <div class="control-section">
                <button id="rules-btn" class="btn secondary">Rules</button>
                <button id="scoreboard-btn" class="btn secondary">Scoreboard</button>
            </div>
            
            <div class="control-section" id="pre-game-controls">
                <button id="new-game-btn" class="btn primary">Start Game</button>
                <div class="game-settings">
                    <label>
                        Points to win: 
                        <input type="number" id="win-points" value="200" min="50" max="500" step="50">
                    </label>
                </div>
            </div>

            <!-- Desktop Game Log and Scoreboard -->
            <div class="desktop-info game-log">
                <h4>Game Log</h4>
                <div id="log-content"></div>
            </div>

            <div class="desktop-info scoreboard">
                <h4>Scoreboard</h4>
                <div id="scoreboard-content"></div>
            </div>
        </div>
    </div>

    <!-- Center Card Animation Areas -->
    <!-- Desktop Center Animation -->
    <div class="center-card-animation-area" id="center-card-animation-area">
        <!-- Animated card appears here for desktop -->
    </div>
    
    <!-- Mobile Center Animation -->
    <div class="mobile-center-card-animation-area" id="mobile-center-card-animation-area">
        <!-- Animated card appears here for mobile -->
    </div>

    <!-- Animation backdrop for focus -->
    <div class="animation-backdrop" id="animation-backdrop"></div>

    <!-- Mobile Action Buttons (fixed at bottom) -->
    <div class="action-buttons-mobile" id="action-buttons-mobile">
        <button id="mobile-hit-btn" class="btn primary">Hit</button>
        <button id="mobile-stay-btn" class="btn secondary">Stay</button>
    </div>

    <!-- Special Action Card Modal -->
    <div class="special-action-modal" id="special-action-modal" style="display: none;">
        <div class="modal-overlay">
            <div class="special-action-content">
                <h3 id="special-action-title">Special Action Card</h3>
                <p id="special-action-description">Drag the card to any player to use it</p>
                
                <div class="special-action-card-container">
                    <div class="special-action-card" id="special-action-card">
                        <!-- Card will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="special-action-players">
                    <h4>Choose Target Player:</h4>
                    <div class="special-action-player-grid" id="special-action-player-grid">
                        <!-- Player drop zones will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Card Prompt -->
    <div class="action-card-prompt" id="action-prompt" style="display: none;">
        <h3 id="action-title">Action Card</h3>
        <p id="action-description"></p>
        <div id="action-buttons"></div>
    </div>

    <!-- Flip 3 handled by Flip3AnimationManager -->

    <!-- Flip 7 Celebration -->
    <div class="flip7-celebration" id="flip7-celebration" style="display: none;">
        <div class="flip7-logo-container" id="flip7-logo-container">
            <img src="images/FLIP7_LOGO_LOCK_UP_transparent.png" alt="Flip 7" class="flip7-celebration-logo" id="flip7-celebration-logo">
        </div>
        <div class="glitter-explosion" id="glitter-explosion"></div>
    </div>

    <!-- Winning Celebration -->
    <div id="winning-celebration" class="winning-celebration" style="display: none;">
        <div class="celebration-banner">
            <h1 id="celebration-text" class="celebration-text">ðŸŽ‰ Congratulations You Won! ðŸŽ‰</h1>
            <p id="celebration-subtext" class="celebration-subtext">Amazing job! Click "Start Game" to play again.</p>
        </div>
        <div class="confetti-container" id="confetti-container"></div>
    </div>

    <!-- Rules Modal -->
    <div id="rules-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="close-rules">&times;</span>
            <h2>Flip 7 Rules</h2>
            <div class="rules-text">
                <h3>Objective</h3>
                <p>Score points by collecting Number cards (0-12) without duplicates. Get exactly 7 unique Number cards for a 15-point bonus!</p>
                
                <h3>How to Play</h3>
                <ol>
                    <li>Each player receives one card to start</li>
                    <li>On your turn: Hit (draw a card) or Stay (keep your points)</li>
                    <li>If you draw a duplicate number, you BUST and score 0 (unless you have Second Chance)</li>
                    <li>Round ends when all players stay/bust OR someone gets 7 unique numbers</li>
                </ol>
                
                <h3>Card Types</h3>
                <ul>
                    <li><strong>Number Cards (0-12):</strong> Worth their face value</li>
                    <li><strong>Freeze:</strong> Drag to any player to freeze them (forces them to stay)</li>
                    <li><strong>Flip Three:</strong> Drag to any player to make them draw 3 cards in a row</li>
                    <li><strong>Second Chance:</strong> Protects from one bust</li>
                    <li><strong>+2, +4, +6, +8, +10:</strong> Bonus points</li>
                    <li><strong>x2:</strong> Doubles your number card total</li>
                </ul>
                
                <h3>Scoring</h3>
                <p>1. Sum all number cards<br>
                2. Apply x2 multiplier (if you have it)<br>
                3. Add modifier bonuses (+2, +4, +6, +8, +10)<br>
                4. Add 15 bonus if you got exactly 7 unique numbers</p>
            </div>
        </div>
    </div>
    
    <!-- Scoreboard Modal -->
    <div id="scoreboard-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="close-scoreboard">&times;</span>
            <h2>Scoreboard</h2>
            <div class="scoreboard-content">
                <table id="modal-scoreboard-table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Round</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="modal-scoreboard-body">
                        <!-- Scores will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modular system - load in dependency order -->
    <!-- Core constants and events -->
    <script src="src/game/config/GameConstants.js?v=1.0"></script>
    <script src="src/events/GameEvents.js?v=1.0"></script>
    <script src="src/events/EventBus.js?v=1.0"></script>
    
    <!-- Debug utilities -->
    <script src="src/utils/DebugUtilities.js?v=1.0"></script>
    
    <!-- Card system -->
    <script src="src/game/cards/Card.js?v=1.0"></script>
    <script src="src/game/cards/Deck.js?v=1.0"></script>
    
    <!-- Game logic -->
    <script src="src/game/core/Player.js?v=1.0"></script>
    <script src="src/game/cards/CardManager.js?v=1.0"></script>
    
    <!-- Game managers -->
    <script src="src/game/managers/AIManager.js?v=1.0"></script>
    <script src="src/game/managers/ActionCardHandler.js?v=1.0"></script>
    <script src="src/game/managers/TurnManager.js?v=1.0"></script>
    <script src="src/game/managers/GameStateManager.js?v=1.0"></script>
    
    <!-- Display sub-modules -->
    <script src="src/ui/display/managers/AnimationManager.js?v=1.0"></script>
    <script src="src/ui/display/managers/TargetingManager.js?v=1.0"></script>
    <script src="src/ui/display/managers/UIUpdateManager.js?v=1.0"></script>
    <script src="src/ui/display/managers/Flip3AnimationManager.js?v=1.0"></script>
    <script src="src/ui/display/managers/SecondChanceAnimationManager.js?v=1.0"></script>
    <script src="src/ui/display/managers/ScoreAnimationManager.js?v=1.0"></script>
    
    <!-- Main display and game engine -->
    <script src="src/ui/display/DisplayManager.js?v=1.0"></script>
    <script src="src/game/core/GameEngine.js?v=1.0"></script>
    
    <!-- Main application -->
    <script src="app.js"></script>
</body>
</html>